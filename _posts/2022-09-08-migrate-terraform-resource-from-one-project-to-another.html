---
layout: post
title: Migrate terraform resource from one project to another
canonical_url: https://medium.com/@suman.maity112/migrate-terraform-resource-from-one-project-to-another-61d0c347419a?source=rss-92eeb3145de9------2
tag:
- state-migration
- terraform-state-mv
- tfstate
- terraform
---

<figure><img alt="" src="https://cdn-images-1.medium.com/max/970/1*5fUQzV5GianB3J20GuHjOg.png" /></figure><p>As part of this article letâ€™s try to understand how can we safely migrate Terraform state from one project to another. But before we start, let us understand when do we need this state migration.</p><h4>When do we need State migrationÂ ?</h4><p>Terraform state migration can be required mainly for these 2 reasonsÂ â€”</p><ol><li>we want to <strong>rename the</strong> <strong>terraform resource without changing the actual resource</strong> on theÂ cloud</li><li>Due to <strong>project architecture change</strong></li></ol><h3>How can we migrate terraform remote stateÂ ?</h3><p>Terraform state migration can be done in multiple waysÂ â€”</p><ol><li>Delete the existing state using terraform state rm and import the existing resource using terraform state import command in the newÂ place.</li><li>Make use of terraform state mvÂ command.</li></ol><p>The recommended and preferred way is using terraform state mvÂ command.</p><h4>How can we make use of terraform state mv commandÂ ?</h4><p>For <em>1st scenario</em>, where we just want to change the <strong>terraform resource name without changing the actual resource </strong>on the same project, itâ€™s pretty straight forward. We can just run the following command to doÂ so</p><p>terraform state mv &quot;aws_secretsmanager_secret.username&quot; &quot;aws_secretsmanager_secret.github_username&quot;</p><p>But for <em>2nd scenario</em>, the state migration becomes little tricky as it is across two different project/workspace. To be able to safely migrate the state, we need to follow the following stepsÂ â€”</p><ol><li>Move the infrastructure code from source project (example: <em>hello_earth</em>) to destination project (example: <em>hello_mars</em>)</li><li>Pull existing state for source project (<em>hello_earth</em>). We can use terraform state pull command and store the output into a file ( hello_earth.tfstate ). Itâ€™s suggested to create a backup file (hello_earth_backup.tfstate) asÂ well.</li><li>Pull existing state for destination project (<em>hello_mars</em>). We can use terraform state pull and store the output into a file ( hello_mars.tfstate ). Itâ€™s suggested create a backup file (hello_mars_backup.tfstate) asÂ well.</li><li>Figure out the terraform resource ids which you want to migrate by using terraform state list on source project (<em>hello_earth</em>).</li><li>Figure out the terraform resource ids in destination project (<em>hello_mars</em>). This can be done by either running terraform plan or can be generated manually. Most of the time itâ€™s &lt;terraform resource type&gt;.&lt;terraform resourceÂ name&gt;</li><li>Once you are done with the above steps, we can start on actual migration. terraform state mv -state=&quot;/Users/john/hello_earth/hello_earth.tfstate&quot; <br> -state-out=&quot;/Users/john/hello_mars/hello_mars.tfstate&quot; &quot;aws_secretsmanager_secret.username&quot; &quot;aws_secretsmanager_secret.github_username&quot;</li><li>Push the newly modified state file for destination project (<em>hello_mars</em>) by using terraform state push &quot;/Users/john/hello_mars/hello_mars.tfstate&quot;</li><li>Push the newly modified state file for source project (<em>hello_earth</em>) by using terraform state push &quot;/Users/john/hello_earth/hello_earth.tfstate&quot;. We need to do it as we moved terraform state from the source file ( hello_earth.tfstate ) to destination file ( hello_mars.tfstate ) i.e. itâ€™s modified.</li><li>Run terraform plan on both the project to verify terraform state move does not any side-effect. Ideally, it should display <em>no changes found. </em>In case, if it displays some changes and changes are not legit, you can always push the backup states and start from the scratch (<em>step 1</em>) without any sideÂ effect.</li><li>Once you verify the changes, push the modified code for both the projects to the remote (exampleâ€Šâ€”â€ŠGithub, BitBucket etc)</li></ol><blockquote>Note 1: You may need to run step 6 multiple times depends on how many resource(s) you want toÂ migrate.</blockquote><blockquote>Note 2: Until state push happens in step 7 and step 8, there is no side effect or changes in remote state. If you make any mistake, you can always start fresh without any side effect on the remoteÂ state.</blockquote><p>Terraform state migration process is always little tricky and risky. I hope this article was able to make the process little simpler than previous.</p><p>PS: I hope youâ€™ve enjoyed it, and if youâ€™ve found it useful, please feel free to share with others or leave a commentÂ ðŸ˜ƒ.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=61d0c347419a" width="1" height="1" alt="">
<p>Originally posted on <a href="https://medium.com/@suman.maity112/migrate-terraform-resource-from-one-project-to-another-61d0c347419a?source=rss-92eeb3145de9------2">medium.com</a>.</p>
