---
layout: post
title: Improved NodeJs Logging with Mapped Diagnostic Context (MDC)
canonical_url: https://medium.com/@suman.maity112/improved-nodejs-logging-with-mapped-diagnostic-context-mdc-c5b0e9729795?source=rss-92eeb3145de9------2
tag:
- logging
- log4j
- nodejs
- mdc
---

<figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*1Fda0AOZdQ5wpVNsSeXJMQ.png" /><figcaption>Image copied from <a href="https://developpaper.com/a-simple-implementation-of-java-service-call-process-tracing/">https://developpaper.com/a-simple-implementation-of-java-service-call-process-tracing/</a></figcaption></figure><p>Mapped Diagnostic Context (MDC) provides a way to enrich log messages with information that could be unavailable at the place where logging actually occurs but can be indeed useful for better tracking of programÂ flow.</p><h4>Why useÂ MDC</h4><p>Letâ€™s assume that we have to write software that downloads receipts for given orderÂ event.</p><p>To perform download, we need to make a simple APIÂ call</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Awnypqk9XjQekNGPSuapNg.png" /></figure><p>The main issue to note here is that <strong>when the log message is created, itâ€™s not possible to access <em>orderId</em></strong><em> or </em><strong><em>traceId, </em></strong>only <strong>receiptId</strong> is accessible.</p><p>Now, if we use this code to fetch receipt for multiple order event parallelly, it will be very hard to map between order event and receipt usingÂ logs.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/924/1*dDt17GXhhoXg3sUaMYUf2A.png" /></figure><h4>How to useÂ MDC</h4><p>We can make use of <a href="https://www.npmjs.com/package/log4js">log4js</a> to log structured message withÂ MDC.</p><p>To be able to configure MDC, we need to first configure log4js to print message in <strong>JSON</strong> format. Same can be achieved by following code</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*WtPJFo8k8zZlGC6RMLTx6g.png" /></figure><p>Once log are getting printed in JSON format, we can make use log.addContext() method to add metadata which can be used for tracking.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*5-Pj4WfhurGRLUjvyEdyHQ.png" /></figure><p>Now, logs will be in JSON format, also itâ€™ll have required metadata.</p><p>Note: <strong>context</strong> will be printed in the logs automatically as you can see in the following image</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*8HU9FgO3ZEpD-XPuxlxORQ.png" /></figure><p>As you can see in the above image, all the logs have corresponding orderId and traceId, therefor if we faced any issue, we will be easily map log message with particular orderÂ event.</p><p>MDC has lot of application, mainly in scenarios of asynchronous/parallel processing caused interleaved messages.</p><p>PS: I hope youâ€™ve enjoyed it, and if youâ€™ve found it useful, please feel free to share with others or leave a comment ðŸ˜ƒ. Incase you want to check the entire file, you can check itÂ <a href="https://gist.github.com/sumanmaity112/41ec20a1f595b8ca82c7b17a121845ca">here</a>.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=c5b0e9729795" width="1" height="1" alt="">
